// src/bdd/hooks.meta.js
import { createBdd } from "playwright-bdd";
import { startScenario, finishScenario, getScenarioMeta } from "../utils/scenarioMeta.js";

const { Before, After } = createBdd();

Before(async ({ $testInfo, $tags }) => {
  const meta = getScenarioMeta($testInfo, $tags);
  console.log(`▶️ [${meta.project}] ${meta.feature} › ${meta.scenario} ${meta.tags.join(" ")}`);
  await startScenario($testInfo, $tags); // atașează scenario-start.json
});

After(async ({ $testInfo }) => {
  const ms = await finishScenario($testInfo); // atașează scenario-summary.json
  const icon = $testInfo.status === "passed" ? "✅" : "❌";
  console.log(`${icon} ${$testInfo.title} — ${$testInfo.status} (${ms} ms)`);
});
