// playwright-working.config.js - Configurație care funcționează sigur
import dotenv from 'dotenv';
import { defineConfig } from '@playwright/test';
import { defineBddProject } from 'playwright-bdd';

dotenv.config({ quiet: true });

const steps = ['src/steps/**/*.js', 'src/fixtures/index.js'];
const isCI = process.env.CI;
const isDebug = process.env.DEBUG_TESTS;

export default defineConfig({
  globalSetup: './src/setup/global-setup.js',
  globalTeardown: './src/setup/global-teardown.js',
  
  timeout: 30 * 1000,
  expect: { timeout: 5000 },
  fullyParallel: true,

  outputDir: isCI ? null : './test-results',
  
  reporter: [
    ['list'], 
    ['allure-playwright', { outputDir: 'allure-results' }]
  ],

  use: { 
    headless: !isDebug,
    trace: 'retain-on-failure',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },

  projects: [
    // API Tests - păstrează configurația exactă din defineBddProject
    {
      ...defineBddProject({
        name: 'api-bdd',
        features: ['src/features/api/**/*.feature'],
        steps,
        outputDir: '.features-gen/api',
      }),
      metadata: { suite: 'API' },
      use: {
        // API specific - disable artifacts
        trace: 'off',
        screenshot: 'off',
        video: 'off',
        baseURL: process.env.API_BASE_URL || 'http://localhost:3000',
      }
    },
    
    // UI Tests
    {
      ...defineBddProject({
        name: 'chromium-ui',
        features: ['src/features/ui/**/*.feature'],
        steps,
        outputDir: '.features-gen/chromium',
      }),
      metadata: { suite: 'UI' },
      use: { 
        browserName: 'chromium',
        headless: !isDebug,
      }
    }
  ]
});